# CI trigger on master branch, only for changes in included path
trigger:
  batch: true
  branches:
    include:
    - master
    - integration

variables:
  # You don't need to change anything here, unless you want to
  # publish docker image or documents to somewhere else.
  - group: kentoso-acr-credentials
  - group: kentoso-dev-twistlock-credentials
  - group: kentoso-private-pypi-url
  # - group: kentoso-doc-blobstorage

resources:
  repositories:
    - repository: templates
      type: github
      name: KenSciML/BuildTemplates
      endpoint: KenSciML
    - repository: self
      type: git
      ref: integration

stages:
- stage: A_Ubuntu
  jobs:
  - job: Test_Latest_Supported_PyVersion
    pool:
      vmImage: ubuntu-latest
    steps:
    - checkout: self
    - task: UsePythonVersion@0
      displayName: Use Python Version
      inputs:
        versionSpec: 3.9.5
    - task: ShellScript@2
      displayName: Build and Test
      inputs:
        scriptPath: integration_test.sh
  - job: Test_Earliest_Supported_PyVersion
    pool:
      vmImage: ubuntu-latest
    steps:
    - checkout: self
    - task: UsePythonVersion@0
      displayName: Use Python Version
      inputs:
        versionSpec: 3.6.8
    - task: ShellScript@2
      displayName: Build and Test
      inputs:
        scriptPath: integration_test.sh


- stage: B_Windows
  jobs:
  - job: Test_Windows
    pool:
      vmImage: windows-2019
    steps:
    - checkout: self
    - task: UsePythonVersion@0
      displayName: Use Python Version
      inputs:
        versionSpec: 3.9.5
    - task: ShellScript@2
      displayName: Build and Test
      inputs:
        scriptPath: integration_test.sh

